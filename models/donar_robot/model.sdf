<?xml version="1.0" ?>
<sdf version="1.9">
  <model name="donar_robot">
    
    <!-- ========================================= -->
    <!-- PLUGINS -->
    <!-- ========================================= -->
    <plugin filename="ignition-gazebo-joint-state-publisher-system" 
            name="ignition::gazebo::systems::JointStatePublisher">
      <topic>/joint_states</topic>
      <update_rate>50</update_rate>
    </plugin>
    
    <plugin filename="ignition-gazebo-odometry-publisher-system" 
            name="ignition::gazebo::systems::OdometryPublisher">
      <odom_topic>/donar_robot/odometry</odom_topic>
      <odom_frame>odom</odom_frame>
      <robot_base_frame>base_link</robot_base_frame>
      <odom_publish_frequency>50</odom_publish_frequency>
    </plugin>
    
    <plugin filename="ignition-gazebo-diff-drive-system" 
        name="ignition::gazebo::systems::DiffDrive">
      <left_joint>left_wheel_joint</left_joint>
      <right_joint>right_wheel_joint</right_joint>
      <wheel_separation>0.52</wheel_separation>
      <wheel_radius>0.14</wheel_radius>
      <max_linear_velocity>3</max_linear_velocity>
      <min_linear_velocity>-3</min_linear_velocity>
      <max_angular_velocity>3.0</max_angular_velocity>
      <min_angular_velocity>-3.0</min_angular_velocity>
      <max_linear_acceleration>2.0</max_linear_acceleration>
      <topic>/donar_robot/cmd_vel</topic>
      <odom_topic>odometry</odom_topic>
      <frame_id>odom</frame_id>
      <child_frame_id>base_link</child_frame_id>
      <odom_publish_frequency>50</odom_publish_frequency>

      <tf_topic>/tf</tf_topic>

    </plugin>
    
    <!-- ========================================= -->
    <!-- BASE LINK -->
    <!-- ========================================= -->
    <link name="base_link">
      <pose>0 0 0 0 0 0</pose>
      <inertial>
        <pose>0.00013095962477824982 1.4938322527424564e-05 0.19291134702067492 0 0 0</pose>
        <mass>35.0</mass>
        <inertia>
          <ixx>4.525119</ixx><ixy>-4.4e-05</ixy><ixz>-0.008986</ixz>
          <iyy>7.683395</iyy><iyz>0.000243</iyz><izz>8.427305</izz>
        </inertia>
      </inertial>
      <visual name="base_link_visual">
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/base_link.stl</uri>
          </mesh>
        </geometry>
      <material>
        <ambient>0.7 0.7 0.7 1.0</ambient>
        <diffuse>0.7 0.7 0.7 1.0</diffuse>
        <specular>0.1 0.1 0.1 1.0</specular>
      </material>
      </visual>
      <collision name="base_link_collision">
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/base_link.stl</uri>
          </mesh>
        </geometry>
      </collision>
    </link>
    
    <!-- ========================================= -->
    <!-- RIGHT WHEEL -->
    <!-- ========================================= -->
    <link name="right_wheel_1">
      <pose relative_to="base_link">0.221 -0.26 0.04 0 0 0</pose>
      <inertial>
        <pose>0.0 -0.025 0.0 0 0 0</pose>
        <mass>2.0</mass>
        <inertia>
          <ixx>0.016277</ixx><ixy>0.0</ixy><ixz>0.0</ixz>
          <iyy>0.031234</iyy><iyz>0.0</iyz><izz>0.016277</izz>
        </inertia>
      </inertial>
      <visual name="right_wheel_visual">
        <pose>-0.221 0.26 -0.04 0 0 0</pose>
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/right_wheel_1.stl</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.0 0.0 0.0 1.0</ambient>
          <diffuse>0.0 0.0 0.0 1.0</diffuse>
          <specular>0.1 0.1 0.1 1.0</specular>
        </material>
      </visual>
      <collision name="right_wheel_collision">
        <pose>-0.221 0.26 -0.04 0 0 0</pose>
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/right_wheel_1.stl</uri>
          </mesh>
        </geometry>
        <surface>
          <friction><ode><mu>1.0</mu><mu2>1.0</mu2></ode></friction>
        </surface>
      </collision>
    </link>
    
    <joint name="right_wheel_joint" type="revolute">
      <parent>base_link</parent>
      <child>right_wheel_1</child>
      <axis>
        <xyz>0.0 1.0 0.0</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
      </axis>
    </joint>
    
    <!-- ========================================= -->
    <!-- LEFT WHEEL -->
    <!-- ========================================= -->
    <link name="left_wheel_1">
      <pose relative_to="base_link">0.221 0.26 0.04 0 0 0</pose>
      <inertial>
        <pose>0.0 0.025 0.0 0 0 0</pose>
        <mass>2.0</mass>
        <inertia>
          <ixx>0.016277</ixx><ixy>0.0</ixy><ixz>0.0</ixz>
          <iyy>0.031234</iyy><iyz>0.0</iyz><izz>0.016277</izz>
        </inertia>
      </inertial>
      <visual name="left_wheel_visual">
        <pose>-0.221 -0.26 -0.04 0 0 0</pose>
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/left_wheel_1.stl</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.0 0.0 0.0 1.0</ambient>
          <diffuse>0.0 0.0 0.0 1.0</diffuse>
          <specular>0.1 0.1 0.1 1.0</specular>
        </material>
      </visual>
      <collision name="left_wheel_collision">
        <pose>-0.221 -0.26 -0.04 0 0 0</pose>
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/left_wheel_1.stl</uri>
          </mesh>
        </geometry>
        <surface>
          <friction><ode><mu>1.0</mu><mu2>1.0</mu2></ode></friction>
        </surface>
      </collision>
    </link>
    
    <joint name="left_wheel_joint" type="revolute">
      <parent>base_link</parent>
      <child>left_wheel_1</child>
      <axis>
        <xyz>0.0 1.0 0.0</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
      </axis>
    </joint>
    
    <!-- ========================================= -->
    <!-- LEFT CASTER (NEW SIMPLIFIED) -->
    <!-- ========================================= -->
    <link name="left_caster_wheel_1">
      <!-- Position: -0.304, 0.2, -0.01 from base_link -->
      <pose relative_to="base_link">-0.304 0.2 -0.01 0 0 0</pose>
      <inertial>
        <!-- Inertial from new design -->
        <pose>0.0 0.0 -0.03891304347826075 0 0 0</pose>
        <mass>0.408490820770769</mass>
        <inertia>
          <ixx>0.000369</ixx><iyy>0.000369</iyy><izz>0.000304</izz>
          <ixy>0.0</ixy><ixz>0.0</ixz><iyz>0.0</iyz>
        </inertia>
      </inertial>
      
      <!-- Visual mesh -->
      <visual name="left_caster_visual">
        <pose>0.304 -0.2 0.01 0 0 0</pose>
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/left_caster_wheel_1.stl</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.0 0.0 0.0 1.0</ambient>
          <diffuse>0.0 0.0 0.0 1.0</diffuse>
          <specular>0.1 0.1 0.1 1.0</specular>
        </material>
      </visual>
      
      <!-- Sphere collision for stable physics -->
      <collision name="left_caster_collision">
        <pose>0.0 0.0 -0.05 0 0 0</pose>
        <geometry>
          <sphere><radius>0.04</radius></sphere>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.01</mu>
              <mu2>0.01</mu2>
            </ode>
          </friction>
          <contact>
            <ode>
              <soft_cfm>0.0001</soft_cfm>
              <soft_erp>0.2</soft_erp>
              <kp>1000000.0</kp>
              <kd>100.0</kd>
            </ode>
          </contact>
        </surface>
      </collision>
    </link>
    
    <joint name="left_caster_joint" type="fixed">
      <parent>base_link</parent>
      <child>left_caster_wheel_1</child>
    </joint>
    
    <!-- ========================================= -->
    <!-- RIGHT CASTER (NEW SIMPLIFIED) -->
    <!-- ========================================= -->
    <link name="right_caster_wheel_1">
      <!-- Position: -0.304, -0.2, -0.01 from base_link -->
      <pose relative_to="base_link">-0.304 -0.2 -0.01 0 0 0</pose>
      <inertial>
        <!-- Inertial from new design -->
        <pose>0.0 0.0 -0.03891304347826075 0 0 0</pose>
        <mass>0.408490820770769</mass>
        <inertia>
          <ixx>0.000369</ixx><iyy>0.000369</iyy><izz>0.000304</izz>
          <ixy>0.0</ixy><ixz>0.0</ixz><iyz>0.0</iyz>
        </inertia>
      </inertial>
      
      <!-- Visual mesh -->
      <visual name="right_caster_visual">
        <pose>0.304 0.2 0.01 0 0 0</pose>
        <geometry>
          <mesh>
            <scale>0.001 0.001 0.001</scale>
            <uri>file:///home/fonyuy45/donar_robot_ws/src/donar_robot_description/meshes/right_caster_wheel_1.stl</uri>
          </mesh>
        </geometry>
        <material>
          <ambient>0.0 0.0 0.0 1.0</ambient>
          <diffuse>0.0 0.0 0.0 1.0</diffuse>
          <specular>0.1 0.1 0.1 1.0</specular>
        </material>
      </visual>
      
      <!-- Sphere collision for stable physics -->
      <collision name="right_caster_collision">
        <pose>0.0 0.0 -0.05 0 0 0</pose>
        <geometry>
          <sphere><radius>0.04</radius></sphere>
        </geometry>
        <surface>
          <friction>
            <ode>
              <mu>0.01</mu>
              <mu2>0.01</mu2>
            </ode>
          </friction>
          <contact>
            <ode>
              <soft_cfm>0.0001</soft_cfm>
              <soft_erp>0.2</soft_erp>
              <kp>1000000.0</kp>
              <kd>100.0</kd>
            </ode>
          </contact>
        </surface>
      </collision>
    </link>
    
    <joint name="right_caster_joint" type="fixed">
      <parent>base_link</parent>
      <child>right_caster_wheel_1</child>
    </joint>
    
  </model>
</sdf>